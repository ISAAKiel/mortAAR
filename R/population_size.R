#' Calculates population size from a mortAAR life table
#' or numeric values
#'
#' The estimation of the population size for a given cemetery is
#' only possible if a stationary population is assumed. In this
#' case, the number of deaths is simply multiplied with the
#' life expectancy at birth and divided be the time span
#' the cemetery was in use. Additionally, it is assumed
#' that an unknown number of individuals
#' is not represented in the cemetery and, therefore, the
#' resulting number is multiplied by an arbitrary value k
#' (\emph{Herrmann et al. 1990}, 311f.).
#'
#'
#' @references
#'
#' \insertRef{herrmann_prahistorische_1990}{mortAAR}
#'
#'
#' @param x either an object of class mortaar_life_table or
#' mortaar_life_table_list or an arbitrary numeric value representing
#' the number of deaths.
#'
#' @param e0 numeric. life expectancy at birth
#' (if x is of class mortaar_life_table then e0 can be derived directly
#' from the life table's ex column).
#'
#' @param k numeric. Arbitrary number to cater for
#' individuals not represented in the number of deaths. Default: 1.1.
#'
#' @param t numeric. Time span of usage of cemetery.
#'
#' @return
#' A data.frame with the following items:
#'
#' \itemize{
#'   \item \bold{D}:  Number of deaths.
#'   \item \bold{e0}:  Life expectancy at birth.
#'   \item \bold{k}:  Correction factor.
#'   \item \bold{t}: Time span of usage of cemetery.
#'   \item \bold{P}: Population size calcuated by the formula
#'  \eqn{P = D * e0 * k / t}
#'  }
#'
#'
#' @examples
#'
#' schleswig <- life.table(schleswig_ma[c("a", "Dx")])
#' lt.population_size(schleswig, t = 100)
#'
#' odagsen <- life.table(list(
#' "corpus mandibulae" = odagsen_cm[c("a", "Dx")],
#'  "margo orbitalis" = odagsen_mo[c("a", "Dx")]
#'  ))
#' lt.population_size(odagsen, e0 = 30, t = 100)
#'
#' lt.population_size(x = 111, e0 = 32.2, k = 1.2, t = 100)

#' @rdname lt.population_size
#' @export
lt.population_size <- function(x, e0, k = 1.1, t) {
  UseMethod("lt.population_size")
}

#' @rdname lt.population_size
#' @export
#' @noRd
lt.population_size.default <- function(x, e0, k = 1.1, t) {
  stop("x must be a valid mortAAR life table or a numeric value.")
}

#' @rdname lt.population_size
#' @export
#' @noRd
lt.population_size.numeric <- function(x, e0, k = 1.1, t) {
  D <- x
  result <- population_size_output(D, e0, k, t)
  return(result)
}

#' @rdname lt.population_size
#' @export
#' @noRd
lt.population_size.mortaar_life_table_list <- function(x, e0, k = 1.1, t) {
  lapply(x, lt.population_size, e0 = e0, k = k,  t = t)
}

#' @rdname lt.population_size
#' @export
#' @noRd
lt.population_size.mortaar_life_table <- function(x, e0 = x$ex[1], k = 1.1, t) {
  D <- sum(x$Dx)
  result <- population_size_output(D, e0, k, t)
  return(result)
}

population_size_output <- function (D, e0, k, t) {
  P <- D * e0 * k / t
  # compiling result table
  data.frame(
    method = c("D", "e0", "k", "t", "P"),
    value = c(
      round(D, 1),
      round(e0, 1),
      k,
      t,
      round(P,1)
    ),
    description = c(
      "Number of deaths",
      "Life expectancy",
      "Correction factor",
      "Time span",
      "Population size"
    ),
    stringsAsFactors = FALSE
  )
}
